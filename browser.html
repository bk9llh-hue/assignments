<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fullpage Proxy Viewer</title>
<link rel="icon" id="fav" href="https://ssl.gstatic.com/classroom/favicon.png">
<style>
html,body{height:100%;margin:0;background:#000}
iframe{width:100%;height:100%;border:0;opacity:0;transform:scale(.995);transition:opacity .25s, transform .25s}
</style>
</head>
<body>
<iframe id="viewer" allowfullscreen sandbox="allow-scripts allow-forms allow-same-origin allow-popups allow-modals allow-top-navigation"></iframe>
<input id="hiddenUrl" type="text" style="position:absolute;left:-9999px;top:-9999px" aria-hidden="true">
<script>
if ('serviceWorker' in navigator) {
navigator.serviceWorker.register('/sw.js').catch(()=>{/* ignore */});
}


const viewer = document.getElementById('viewer');
const hidden = document.getElementById('hiddenUrl');


function getTargetFromPath() {
let p = location.pathname.slice(1);
if (!p) return null;
try { p = decodeURIComponent(p); } catch {}
if (p.startsWith('classroom://')) p = p.replace(/^classroom:\/\//i, 'https://');
if (!/^[a-zA-Z]+:\/\//.test(p)) p = 'https://' + p;
return p;
}


function load(url) {
if (!url) { viewer.srcdoc = '<!doctype html><html><body style="background:#111;margin:0"></body></html>'; viewer.style.opacity = 1; return; }
hidden.value = url;
const prox = '/' + encodeURIComponent(url);
viewer.style.opacity = 0;
setTimeout(()=>{ viewer.src = prox; }, 80);
}


viewer.addEventListener('load', ()=>{
viewer.style.opacity = 1;
try {
const doc = viewer.contentDocument || viewer.contentWindow.document;
const title = doc.title;
if (title) document.title = title;
const icon = doc.querySelector('link[rel*="icon"]');
if (icon && icon.href) document.getElementById('fav').href = icon.href;
} catch(e) {
try { document.title = new URL(hidden.value).hostname; } catch{}
}
});


window.addEventListener('keydown', (e)=>{
if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
e.preventDefault();
viewer.contentWindow.location.reload(true);
}
});


load(getTargetFromPath());
</script>
</body>
</html>
