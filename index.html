<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultra Smart Browser with Drag & Auto-Sorting Bookmarks</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
* { box-sizing:border-box; margin:0; padding:0; user-select:none; }
body, html { height:100%; font-family:'Poppins',sans-serif; display:flex; flex-direction:column; background:#f1f3f4; overflow:hidden; }

.top-bar { display:flex; flex-direction:column; background:#fff; box-shadow:0 3px 6px rgba(0,0,0,0.12); padding:6px 12px; z-index:300; position:relative; }

/* Tabs */
.tabs { display:flex; align-items:flex-end; gap:6px; overflow-x:auto; scroll-snap-type:x mandatory; height:40px; padding-bottom:4px; margin-bottom:2px; }
.tabs::-webkit-scrollbar { display:none; }
.tab { display:flex; align-items:center; min-width:120px; max-width:250px; height:36px; background:#e0e0e0; border-radius:8px 8px 0 0; flex-shrink:0; cursor:pointer; scroll-snap-align:start; transition:all 0.3s ease; padding:0 10px; box-shadow:0 1px 3px rgba(0,0,0,0.1); }
.tab.active { background:#1a73e8; color:white; box-shadow:0 4px 12px rgba(0,0,0,0.25); }
.tab:hover:not(.active) { background:#d5d5d5; transform:translateY(-2px); }
.tab img.favicon { width:16px; height:16px; margin-right:6px; border-radius:2px; }
.tab span.title { flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; font-size:13px; }
.tab .close { width:20px; height:20px; display:flex; justify-content:center; align-items:center; font-size:14px; margin-left:6px; border-radius:50%; cursor:pointer; transition:0.2s; color:#666; }
.tab .close:hover { background:rgba(0,0,0,0.1); transform:scale(1.2); }

/* New tab button */
.new-tab-btn { width:30px; height:30px; border-radius:50%; background:#e0e0e0; border:none; display:flex; justify-content:center; align-items:center; cursor:pointer; font-size:24px; transition:all 0.2s; }
.new-tab-btn:hover { background:#1a73e8; color:white; transform:translateY(-2px); }

/* URL bar row */
.urlbar-row { display:flex; align-items:center; gap:6px; background:#f1f3f4; padding:6px 0; position:relative; z-index:300; }

/* Navigation buttons */
.nav-btn { width:36px; height:36px; display:flex; justify-content:center; align-items:center; font-size:22px; border-radius:8px; cursor:pointer; color:#666; transition:all 0.2s; }
.nav-btn:hover { background:#e0e0e0; color:#000; }
.nav-btn.disabled { opacity:0.3; pointer-events:none; }

/* URL bar */
.urlbar { flex:1; display:flex; align-items:center; background:#ffffff; border-radius:24px; padding:0 12px; height:38px; box-shadow:0 1px 3px rgba(0,0,0,0.12); position:relative; transition:all 0.2s; }
.urlbar:hover { background:#f7f7f7; }
.urlbar img { width:20px; height:20px; margin-right:8px; border-radius:2px; }
.urlbar input { flex:1; border:none; outline:none; font-size:14px; background:transparent; color:#333; }

/* Suggestions dropdown */
.suggestions { position:absolute; top:42px; left:0; right:0; background:#fff; border-radius:6px; box-shadow:0 6px 12px rgba(0,0,0,0.15); display:none; flex-direction:column; z-index:100; max-height:250px; overflow-y:auto; }
.suggestions div { padding:8px 12px; cursor:pointer; transition:background 0.2s; }
.suggestions div:hover, .suggestion-hover { background:#f1f3f4; }

/* Bookmarks bar */
.bookmarks-bar { display:flex; align-items:center; gap:6px; background:#e8f0fe; padding:4px 8px; overflow-x:auto; border-bottom:1px solid #ccc; }
.bookmarks-bar::-webkit-scrollbar { display:none; }
.bookmark-item { padding:4px 6px; background:#fff; border-radius:4px; cursor:pointer; white-space:nowrap; display:flex; align-items:center; gap:4px; font-size:13px; transition:all 0.2s; }
.bookmark-item.dragging { opacity:0.5; border:2px dashed #1a73e8; }
.bookmark-item:hover { background:#d2e3fc; }
.bookmark-item img { width:16px; height:16px; border-radius:2px; }
.bookmark-item span.name { flex:1; }
.bookmark-item span.actions { font-size:16px; cursor:pointer; display:none; }
.bookmark-item:hover span.actions { display:inline; }

/* Iframe container */
#iframe-container { flex:1; background:#fff; overflow:hidden; position:relative; }
#iframe-container iframe { width:100%; height:100%; border:none; transition:opacity 0.35s ease, transform 0.35s ease; opacity:0; transform:scale(0.98); }

/* Reload spin animation */
.reload-spin { animation:spin 0.6s linear; }
@keyframes spin { from{ transform:rotate(0deg);} to{ transform:rotate(360deg);} }

/* Multi-tab close animation */
.tab-closing { transform:scaleX(0) translateY(-5px); opacity:0; transition:all 0.25s ease; }
</style>
</head>
<body>

<div class="top-bar">
  <div class="tabs" id="tabs"></div>
  <div class="urlbar-row">
    <span id="back" class="nav-btn material-icons disabled">arrow_back</span>
    <span id="forward" class="nav-btn material-icons disabled">arrow_forward</span>
    <div class="urlbar">
      <img src="https://www.google.com/s2/favicons?domain=google.com" id="favicon">
      <input id="urlInput" placeholder="Enter website or assignment URL"/>
      <div class="suggestions" id="suggestions"></div>
    </div>
    <span id="bookmarkBtn" class="material-icons" style="cursor:pointer; font-size:24px; margin-left:8px;">bookmark</span>
    <span id="reload" class="material-icons" style="cursor:pointer; font-size:24px; margin-left:8px;">refresh</span>
  </div>
  <div class="bookmarks-bar" id="bookmarksBar"></div>
</div>

<div id="iframe-container">
  <iframe id="viewer"></iframe>
</div>

<script>
const proxyBase="/assignment";
let tabs=[], currentTabId=null;
let bookmarks=[];
const tabContainer=document.getElementById("tabs");
const urlInput=document.getElementById("urlInput");
const viewer=document.getElementById("viewer");
const faviconEl=document.getElementById("favicon");
const suggestionsEl=document.getElementById("suggestions");
const reloadBtn=document.getElementById("reload");
const backBtn=document.getElementById("back");
const forwardBtn=document.getElementById("forward");
const bookmarkBtn=document.getElementById("bookmarkBtn");
const bookmarksBar=document.getElementById("bookmarksBar");

let historyList=[]; 
let suggestionIndex=-1;

// ------------------ Tabs ------------------
function createTab(name="New Tab", url="classroom://welcome"){
    const id=Date.now();
    const tab={id,name,url,history:[url],historyIndex:0};
    tabs.push(tab);
    renderTabs(true);
    setActiveTab(id);
}

function closeTab(id){
    const index=tabs.findIndex(t=>t.id===id);
    if(index===-1) return;
    const el=document.querySelector(`.tab[data-id='${id}']`);
    if(el){ el.classList.add("tab-closing");
        setTimeout(()=>{ tabs.splice(index,1); renderTabs(); if(currentTabId===id && tabs.length) setActiveTab(tabs[0].id); },250);}
}

function renderTabs(animated=false){
    tabContainer.innerHTML='';
    tabs.forEach(tab=>{
        const el=document.createElement("div");
        el.className='tab show';
        el.setAttribute("data-id",tab.id);
        el.innerHTML=`<img class="favicon" src="https://www.google.com/s2/favicons?domain=${(new URL(tab.url.replace("classroom://","https://"))).hostname}"><span class="title">${tab.name}</span><span class="close" onclick="closeTab(${tab.id})">×</span>`;
        el.onclick=()=>setActiveTab(tab.id);
        if(animated){ el.style.opacity=0; el.style.transform="translateX(20px)"; setTimeout(()=>{ el.style.opacity=1; el.style.transform="translateX(0)"; },50);}
        tabContainer.appendChild(el);
    });
    const newBtn=document.createElement("button"); newBtn.className='new-tab-btn'; newBtn.innerHTML='+';
    newBtn.onclick=()=>createTab(); tabContainer.appendChild(newBtn);
}

// ------------------ Active tab ------------------
function setActiveTab(id){
    currentTabId=id;
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    const el=document.querySelector(`.tab[data-id='${id}']`);
    if(el) el.classList.add("active");
    el.scrollIntoView({behavior:"smooth", inline:"center"});

    const tab=tabs.find(t=>t.id===id);
    if(tab){
        let displayUrl=tab.history[tab.historyIndex].replace(/^https?:\/\//,'').replace(/^classroom:\/\//,'');
        urlInput.value=displayUrl;
        updateNavButtons(tab);
        loadTabUrl(tab);
        try{ faviconEl.src=`https://www.google.com/s2/favicons?domain=${(new URL(tab.history[tab.historyIndex].replace("classroom://","https://"))).hostname}`;}catch{}

        // Auto-update bookmarks if this URL exists in bookmarks
        const bookmark=bookmarks.find(b=>b.url===tab.history[tab.historyIndex]);
        if(bookmark){
            updateBookmark(bookmark);
            bookmark.lastVisited=Date.now();
            sortBookmarks();
        }
    }
}

// ------------------ Fetch page title ------------------
async function fetchTitle(url){
    try{
        const response=await fetch(proxyBase+"/"+encodeURIComponent(url));
        const text=await response.text();
        const parser=new DOMParser();
        const doc=parser.parseFromString(text,"text/html");
        return doc.querySelector("title")?.textContent || null;
    } catch(e){ return null; }
}

// ------------------ Load site ------------------
function loadSite(url=null){
    let u=url||urlInput.value.trim();
    if(!u) return;
    let displayUrl=u.replace(/^https?:\/\//,'').replace(/^classroom:\/\//,''); 
    if(!u.startsWith("https://") && !u.startsWith("http://")) u="https://"+u;
    const tab=tabs.find(t=>t.id===currentTabId);
    if(tab){ tab.history=tab.history.slice(0,tab.historyIndex+1); tab.history.push(u); tab.historyIndex=tab.history.length-1; setActiveTab(currentTabId);}
    if(!historyList.includes(displayUrl)) historyList.unshift(displayUrl);
    showSuggestions();
}

// ------------------ Suggestions ------------------
urlInput.addEventListener("input", showSuggestions);
urlInput.addEventListener("keydown", e=>{
    const items=Array.from(suggestionsEl.children);
    if(e.key==="ArrowDown"){ suggestionIndex=Math.min(suggestionIndex+1, items.length-1); updateSuggestionHover(items); e.preventDefault();}
    if(e.key==="ArrowUp"){ suggestionIndex=Math.max(suggestionIndex-1,0); updateSuggestionHover(items); e.preventDefault();}
    if(e.key==="Enter"){ 
        if(suggestionIndex>=0) loadSite(items[suggestionIndex].textContent); 
        else loadSite(); 
        suggestionsEl.style.display="none"; 
        suggestionIndex=-1;
    }
});
document.addEventListener("click", e=>{ if(!urlInput.contains(e.target)) suggestionsEl.style.display="none"; });
function updateSuggestionHover(items){ items.forEach((item,i)=>item.classList.toggle("suggestion-hover",i===suggestionIndex)); }
function showSuggestions(){
    const val=urlInput.value.toLowerCase();
    suggestionsEl.innerHTML=''; suggestionIndex=-1;
    if(!val){ suggestionsEl.style.display='none'; return;}
    const matches=historyList.filter(h=>h.toLowerCase().includes(val));
    const popular=["welcome","assignments","google.com"];
    popular.forEach(p=>{ if(p.toLowerCase().includes(val) && !matches.includes(p)) matches.push(p); });
    matches.forEach(m=>{
        const div=document.createElement("div"); div.textContent=m;
        div.onclick=()=>{ loadSite(m); suggestionsEl.style.display='none'; suggestionIndex=-1;}
        suggestionsEl.appendChild(div);
    });
    suggestionsEl.style.display = matches.length?'flex':'none';
}

// ------------------ Load iframe ------------------
function loadTabUrl(tab){
    viewer.style.opacity=0; viewer.style.transform='scale(0.98)';
    setTimeout(()=>{
        const encoded=encodeURIComponent(tab.history[tab.historyIndex]);
        viewer.src=`${proxyBase}/${encoded}`;
        viewer.onload=()=>{ viewer.style.opacity=1; viewer.style.transform='scale(1)'; }
    },150);

    // Update bookmark if exists
    const bookmark=bookmarks.find(b=>b.url===tab.history[tab.historyIndex]);
    if(bookmark) updateBookmark(bookmark);
}

// ------------------ Reload ------------------
reloadBtn.addEventListener("click", ()=>{
    reloadBtn.classList.add("reload-spin");
    setTimeout(()=>reloadBtn.classList.remove("reload-spin"),600);
    const tab=tabs.find(t=>t.id===currentTabId);
    if(tab) loadTabUrl(tab);
});

// ------------------ Navigation ------------------
function updateNavButtons(tab){
    backBtn.classList.toggle("disabled", tab.historyIndex<=0);
    forwardBtn.classList.toggle("disabled", tab.historyIndex>=tab.history.length-1);
}
backBtn.addEventListener("click", ()=>{
    const tab=tabs.find(t=>t.id===currentTabId);
    if(tab && tab.historyIndex>0){ tab.historyIndex--; setActiveTab(tab.id);}
});
forwardBtn.addEventListener("click", ()=>{
    const tab=tabs.find(t=>t.id===currentTabId);
    if(tab && tab.historyIndex<tab.history.length-1){ tab.historyIndex++; setActiveTab(tab.id);}
});

// ------------------ Bookmarks ------------------
bookmarkBtn.addEventListener("click", ()=>{
    const tab=tabs.find(t=>t.id===currentTabId);
    if(tab){
        const existing=bookmarks.find(b=>b.url===tab.history[tab.historyIndex]);
        if(!existing){
            const fav=`https://www.google.com/s2/favicons?domain=${(new URL(tab.history[tab.historyIndex].replace("classroom://","https://"))).hostname}`;
            fetchTitle(tab.history[tab.historyIndex]).then(title=>{
                bookmarks.push({name:title||tab.history[tab.historyIndex].replace(/^https?:\/\//,''), url:tab.history[tab.historyIndex], icon:fav, lastVisited:Date.now()});
                sortBookmarks();
                renderBookmarksBar();
            });
        }
    }
});

async function updateBookmark(bookmark){
    bookmark.icon=`https://www.google.com/s2/favicons?domain=${(new URL(bookmark.url.replace("classroom://","https://"))).hostname}`;
    const title=await fetchTitle(bookmark.url);
    bookmark.name=title||bookmark.url.replace(/^https?:\/\//,'');
    bookmark.lastVisited=Date.now();
    sortBookmarks();
    renderBookmarksBar();
}

function sortBookmarks(){ bookmarks.sort((a,b)=>b.lastVisited-a.lastVisited); }

// ------------------ Render bookmarks ------------------
function renderBookmarksBar(){
    bookmarksBar.innerHTML='';
    bookmarks.forEach((b,index)=>{
        const div=document.createElement("div");
        div.className="bookmark-item";
        div.draggable=true;
        div.innerHTML=`<img src="${b.icon}"><span class="name">${b.name}</span><span class="actions">⋮</span>`;
        div.onclick=()=>loadSite(b.url);

        const actions=div.querySelector(".actions");
        actions.addEventListener("click",(e)=>{
            e.stopPropagation();
            const choice=prompt("Edit URL or type 'delete' to remove:",b.url);
            if(choice==="delete"){ bookmarks.splice(index,1); renderBookmarksBar();}
            else if(choice){ b.url=choice; updateBookmark(b); }
        });

        // Drag & drop
        div.addEventListener("dragstart",()=>div.classList.add("dragging"));
        div.addEventListener("dragend",()=>{ div.classList.remove("dragging"); renderBookmarksBar(); });

        div.addEventListener("dragover",(e)=>{ e.preventDefault(); 
            const dragging=document.querySelector(".bookmark-item.dragging");
            const all=[...bookmarksBar.children].filter(c=>!c.classList.contains("dragging"));
            const after=all.find(c=>e.clientX<c.getBoundingClientRect().left+c.offsetWidth/2);
            if(after) bookmarksBar.insertBefore(dragging,after); else bookmarksBar.appendChild(dragging);
        });

        bookmarksBar.appendChild(div);
    });
}

// ------------------ Select all on focus ------------------
urlInput.addEventListener("focus", ()=>urlInput.select());

// ------------------ Init ------------------
createTab("Classroom","classroom://welcome");
</script>
</body>
</html>
